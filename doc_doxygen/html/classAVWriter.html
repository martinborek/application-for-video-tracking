<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>Video Anonymizer: AVWriter Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Video Anonymizer
   </div>
   <div id="projectbrief">The application tracks objects in a video and anonymizes them.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="classAVWriter-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">AVWriter Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a07d7498d6d2dda57dd1d61432f09067c"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAVWriter.html#a07d7498d6d2dda57dd1d61432f09067c">initialize_output</a> (std::string filename, AVStream const *inVideoStream, AVStream const *inAudioStream, char const *inFormatName, std::string inFileExtension)</td></tr>
<tr class="separator:a07d7498d6d2dda57dd1d61432f09067c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6a7f5e05adb1e6c62baf2012a2cfc7cc"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAVWriter.html#a6a7f5e05adb1e6c62baf2012a2cfc7cc">close_output</a> ()</td></tr>
<tr class="separator:a6a7f5e05adb1e6c62baf2012a2cfc7cc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af2d42cafca32a4d9fe45dab2e3ae9716"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAVWriter.html#af2d42cafca32a4d9fe45dab2e3ae9716">write_video_frame</a> (<a class="el" href="classVideoFrame.html">VideoFrame</a> &amp;frame)</td></tr>
<tr class="separator:af2d42cafca32a4d9fe45dab2e3ae9716"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac20a509a57e2f3dbd9a7319e267ea3e4"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAVWriter.html#ac20a509a57e2f3dbd9a7319e267ea3e4">write_audio_packet</a> (AVPacket &amp;pkt)</td></tr>
<tr class="separator:ac20a509a57e2f3dbd9a7319e267ea3e4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1e65c6ce5f555bb7c514fafbff6f407a"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAVWriter.html#a1e65c6ce5f555bb7c514fafbff6f407a">write_last_frames</a> ()</td></tr>
<tr class="separator:a1e65c6ce5f555bb7c514fafbff6f407a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock">
<p>Definition at line <a class="el" href="avwriter_8h_source.html#l00030">30</a> of file <a class="el" href="avwriter_8h_source.html">avwriter.h</a>.</p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a6a7f5e05adb1e6c62baf2012a2cfc7cc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool AVWriter::close_output </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Correct closing of the output file. </p><dl class="section return"><dt>Returns</dt><dd>True if successful </dd></dl>

<p>Definition at line <a class="el" href="avwriter_8cpp_source.html#l00185">185</a> of file <a class="el" href="avwriter_8cpp_source.html">avwriter.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a07d7498d6d2dda57dd1d61432f09067c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool AVWriter::initialize_output </td>
          <td>(</td>
          <td class="paramtype">std::string&#160;</td>
          <td class="paramname"><em>filename</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">AVStream const *&#160;</td>
          <td class="paramname"><em>inVideoStream</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">AVStream const *&#160;</td>
          <td class="paramname"><em>inAudioStream</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char const *&#160;</td>
          <td class="paramname"><em>inFormatName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string&#160;</td>
          <td class="paramname"><em>inFileExtension</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Initializes contexts, opens codecs and opens the output file for writing. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">filename</td><td>Output filename </td></tr>
    <tr><td class="paramname">inVideoStream</td><td>Input video stream </td></tr>
    <tr><td class="paramname">inAudioStream</td><td>Input audio stream </td></tr>
    <tr><td class="paramname">inFormatName</td><td>Name of the input file format </td></tr>
    <tr><td class="paramname">inFileExtension</td><td>Extension of the input file </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>True if initialization successful </dd></dl>
<p>choose extension according the file format: std::string str(formatContext-&gt;iformat-&gt;name); std::string ext = str.substr(0, str.find(',')); filename += "."; filename += ext; qDebug() &lt;&lt; ext.c_str(); avformat_alloc_output_context2(&amp;formatContext2, NULL, ext.c_str(), NULL); // allocation of output context</p>
<pre class="fragment"> Output video format deduction form the (output) filename.
 It is disabled because format should match the input format so as extra settings is not needed.
 Encoding to some other formats might not be valid especially because mixed PTS and DTS
</pre><p>std::string originalFilename = filename; // "filename" might change the extension if needed; "originalFilename" stores the argument Allocating output media context avformat_alloc_output_context2(&amp;formatContext, nullptr, nullptr, filename.c_str()); // allocation of output context</p>
<p>if (!formatContext || formatContext-&gt;oformat-&gt;video_codec == AV_CODEC_ID_NONE) { if (!formatContext) { qDebug() &lt;&lt; "Warning: Could not deduce output format from file extension. Deducing from input format instead."; } else { qDebug() &lt;&lt; "Warning: File format deduced from file extension does not support video. Deducing from input format instead."; avformat_free_context(formatContext); formatContext = nullptr; }</p>
<p>Try allocate formatContext according to input format name and set appropriate extension The new extension is added after the previous one (user might want to have a dot in the filename) std::string str(inFormatName); std::string ext = str.substr(0, str.find(',')); // Finds first extension that belongs to given file format if (!ext.empty()) // Appropriate extension found { filename = originalFilename + "." + ext; qDebug() &lt;&lt; ext.c_str(); avformat_alloc_output_context2(&amp;formatContext, NULL, ext.c_str(), NULL); // allocation of output context } }</p>

<p>Definition at line <a class="el" href="avwriter_8cpp_source.html#l00032">32</a> of file <a class="el" href="avwriter_8cpp_source.html">avwriter.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="ac20a509a57e2f3dbd9a7319e267ea3e4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool AVWriter::write_audio_packet </td>
          <td>(</td>
          <td class="paramtype">AVPacket &amp;&#160;</td>
          <td class="paramname"><em>pkt</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Writes the audio packet to the output audio stream. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pkt</td><td>Packet to be written </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>True if successful </dd></dl>

<p>Definition at line <a class="el" href="avwriter_8cpp_source.html#l00416">416</a> of file <a class="el" href="avwriter_8cpp_source.html">avwriter.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a1e65c6ce5f555bb7c514fafbff6f407a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool AVWriter::write_last_frames </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Writes all frames remaining in the encoder; emptying buffers. </p><dl class="section return"><dt>Returns</dt><dd>True if successful </dd></dl>

<p>Definition at line <a class="el" href="avwriter_8cpp_source.html#l00376">376</a> of file <a class="el" href="avwriter_8cpp_source.html">avwriter.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="af2d42cafca32a4d9fe45dab2e3ae9716"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool AVWriter::write_video_frame </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classVideoFrame.html">VideoFrame</a> &amp;&#160;</td>
          <td class="paramname"><em>frame</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Writes the video frame to the output video stream. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">frame</td><td>Frame to be written </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>True if successful </dd></dl>
<p>Commented because not tested if (formatContext-&gt;oformat-&gt;flags &amp; AVFMT_RAWPICTURE) { // avoiding data copy with some raw video muxers qDebug() &lt;&lt; "raw"; pkt.flags |= AV_PKT_FLAG_KEY; pkt.stream_index = videoStream-&gt;index; pkt.data = (uint8_t *)avFrame; pkt.size = sizeof(AVPicture); pkt.pts = pkt.dts = frame.get_timestamp(); } else {</p>
<p>} </p>

<p>Definition at line <a class="el" href="avwriter_8cpp_source.html#l00309">309</a> of file <a class="el" href="avwriter_8cpp_source.html">avwriter.cpp</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>headers/<a class="el" href="avwriter_8h_source.html">avwriter.h</a></li>
<li>sources/<a class="el" href="avwriter_8cpp_source.html">avwriter.cpp</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed May 20 2015 11:20:36 for Video Anonymizer by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.9.1
</small></address>
</body>
</html>
